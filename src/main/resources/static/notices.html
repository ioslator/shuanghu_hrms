<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>系统公告</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <style>
        body { background-color: #f8f9fa; padding: 20px; }
        .notice-item { transition: all 0.2s; border-left: 4px solid transparent; cursor: pointer; }
        .notice-item:hover { background-color: white; transform: translateX(5px); border-left-color: #007bff; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
        .notice-date { font-size: 0.9rem; color: #adb5bd; width: 100px; text-align: right; }
        .badge-new { background-color: #ff6b6b; color: white; font-size: 0.7rem; padding: 2px 5px; border-radius: 4px; vertical-align: text-top; }
    </style>
</head>
<body>
<div class="container">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h4 class="mb-0">公司公告</h4>
        <button class="btn btn-primary btn-sm" onclick="alert('发布功能仅管理员可用')">
            <i class="fas fa-edit"></i> 发布公告
        </button>
    </div>

    <div class="list-group" id="noticeList">
        <div class="text-center py-5 text-muted">
            <div class="spinner-border text-primary spinner-border-sm" role="status"></div>
            加载公告中...
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        fetch('api/notices')
            .then(res => res.json())
            .then(data => {
                const container = document.getElementById('noticeList');
                container.innerHTML = ''; // 清空加载动画

                if (data.length === 0) {
                    container.innerHTML = '<div class="text-center text-muted py-5">暂无公告</div>';
                    return;
                }

                data.forEach(item => {
                    // 根据不同部门给图标换个颜色（可选美化）
                    let iconColor = 'text-primary';
                    if (item.dept.includes('人事')) iconColor = 'text-danger';
                    if (item.dept.includes('技术')) iconColor = 'text-info';

                    const newItem = `
                            <div class="list-group-item list-group-item-action notice-item d-flex justify-content-between align-items-center py-3" onclick="showDetail(${item.id})">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-bullhorn ${iconColor} mr-3 fa-lg"></i>
                                    <div>
                                        <h6 class="mb-1 font-weight-bold">
                                            ${item.title}
                                            ${item.isNew ? '<span class="badge-new">NEW</span>' : ''}
                                        </h6>
                                        <small class="text-muted">发布部门：${item.dept}</small>
                                    </div>
                                </div>
                                <div class="notice-date">
                                    <div class="font-weight-bold">${item.dateDay}</div>
                                    <small>${item.dateYear}</small>
                                </div>
                            </div>
                        `;
                    container.innerHTML += newItem;
                });
            })
            .catch(err => {
                console.error(err);
                document.getElementById('noticeList').innerHTML =
                    '<div class="text-center text-danger py-3">加载失败，请检查数据库或网络</div>';
            });
    });

    function showDetail(id) {
        alert("即将跳转到公告详情页，ID: " + id);
        // window.location.href = 'notice_detail.html?id=' + id;
    }
</script>
</body>
</html>